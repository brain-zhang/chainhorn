# BOLT＃0：简介和索引

朋友，欢迎你！这些基于闪电技术(BOLT)的文件描述了一种区块链下交易的第二层协议，通过相互合作进行场外比特币转账，只在必要时依赖于链上交易来执行。

有些要求很微妙;我们试图强调您在这里看到的结果背后的动机和推理。我们现在做的还不够好;如果您发现有任何困惑或错误的地方，请与我们联系并帮助我们改进。

这是版本0。

1. [BOLT #1](01-messaging.md)：基本协议
2. [BOLT #2](02-peer-protocol.md): 用于通道管理的对等协议
3. [BOLT＃3](03-transactions.md)：比特币交易和脚本格式
4. [BOLT＃4](04-onion-routing.md):洋葱(Onion)路由协议
5. [BOLT＃5](05-onchain.md)：对链上交易处理的建议
7. [BOLT＃7](07-routing-gossip.md)：P2P节点和通道发现
8. [BOLT＃8](08-transport.md)：加密和认证传输
9. [BOLT＃9](09-features.md)：分配的功能标志
10. [BOLT＃10](10-dns-bootstrap.md)：DNS引导程序和辅助节点位置
11. [BOLT＃11](11-payment-encoding.md)：闪电网络付款的发票协议


## Spark：闪电网络简介

Lightning是一种基于比特币使用创建网络通道进行快速支付的协议。

### 通道(Channels)

Lightning的工作原理是建立*通道*:两个参与者创建一个包含一定数量比特币(例如0.1比特币)的闪电支付通道，这些比特币将锁定在比特币网络上。花费这些币需要同时有两个参与者的签名。

最初，他们各自持有一笔比特币交易，这笔交易将他们彼此手中的比特币(如0.1比特币)发送给一个合约地址。之后，他们可以签署一项新的比特币交易，以不同的方式分割这些资金，比如一方拥有0.09比特币，另一方拥有0.01比特币，并作废之前的交易，这样之前交易种的币就不会被花掉。

有关通道建立的详细信息，请参阅[BOLT＃2：设立通道](02-peer-protocol.md#channel-establishment);

有关用于创建通道的比特币交易的格式，请参阅[BOLT＃3：资金交易输出](03-transactions.md#funding-transaction-output)；

当参与者不同意或失败时，必须使用交叉签名的比特币交易，请参阅[BOLT #5: 链上交易处理的建议](05-onchain.md)。

### 条件支付

Lightning通道仅允许在两个参与者之间进行支付，但是通道可以连接在一起以形成允许在网络的所有成员之间进行支付的网络。这种技术被成为条件支付(Conditional Payments)，它可以被添加到一个通道，例如。“如果你在6小时内得到这个密钥，你将得到0.01比特币。一旦接收方提供了这个密钥，比特币交易就会被缺少有条件支付的交易所取代，并将资金添加到接收方的输出中。

了解为参与者用于添加条件支付的命令,请参阅[BOLT＃2：添加HTLC](02-peer-protocol.md#forwarding-htlcs)；

了解用于比特币承诺交易的完整格式，请参阅[以及]BOLT＃3：承诺交易(Commitment Transaction)](03-transactions.md#commitment-transaction)

### 转发

条件支付可以安全地转寄给其他参加者，但时间较短，例如:“如果你在5小时内告诉我密钥，你将得到0.01比特币。”这允许将支付通道链接到网络中而不信任中间人。

有关条件支付的详细信息，请参阅[BOLT＃2：转发HTLC](02-peer-protocol.md#forwarding-htlcs);

有关传输支付指令的数据包结构，请参阅[BOLT＃4：数据包结构](04-onion-routing.md#packet-structure)。

### 网络拓扑结构

要进行付款，参与者需要知道它可以通过哪些通道发送。参与者互相告知通道和节点的创建及更新。

有关通信协议的详细信息，请参阅[BOLT＃7：P2P节点和通道发现](07-routing-gossip.md);

有关初始网络引导，请参阅[BOLT＃10：DNS引导程序和辅助节点位置](10-dns-bootstrap.md)。

### 付款发票

参与者会收到发票，告诉她要付款。

请参阅[BOLT＃11：Lightning Payments的发票协议](11-payment-encoding.md)，了解描述付款目的地和目的的协议，以便付款人以后可以证明付款成功。

## 术语表和术语指南

* *公告(Announcement)*：

    * 在各通讯端(peers)之间发送的通知消息，用于帮助发现通道(channel)或节点(node)。

    * 链HASH(`chain_hash`)：
        * 目标区块链的唯一标识哈希（通常是genesis哈希）。
          这允许节点*nodes*在几个区块链上创建和引用通道*channels*。节点将忽略引用其未知的`chain_hash`的任何消息。
          与比bitcoin-cli不同，哈希不是反向的，而是直接使用。
          对于比特币区块链主链，`chain_hash`值必须（以十六进制编码）：`6fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000`。

* *通道(Channel)*:

    * 在两个通讯端 `peers`之间进行链下交易的一种快速的方法。
    要处理资金，需要双方交换签名以创建更新的交易(commitment transaction)。
    * 参见交易关闭方法:相互关闭、撤销事务关闭、单边关闭
    * 参阅：route_

* *关闭交易*:

    * 作为相互关闭的一部分而生成的交易。结束交易类似于承诺交易，但没有待付款。
    * 相关：承诺交易，融资交易，罚款交易

* *承诺交易编号(Commitment number)*：
    * 每个承诺交易拥有48位递增计数器;计数器独立于通道中的每个对等点，从0开始。
    * 见容器：承诺交易
    * 见相关：关闭交易，融资交易，罚款交易

* *承诺撤销私钥*：
    * 每个承诺交易都有一个唯一的承诺撤销私有密匙值，该值允许另一个通讯端立即使用所有未花费的币，
     承诺交易的撤销时间是关键。为了支持撤销，承诺交易的每个输出(output)都引用承诺撤销公钥。
    * 参见容器：承诺交易
    * 参见发起交易人：承诺密钥

* *承诺交易(Commitment transaction)*：
    * 承诺交易指的是花费基础(Fund)交易的输出。
     交易双方都拥有该交易的另一方的签名，因此交易双方都有一个可以花费的承诺交易。
     在协商新的承诺交易之后，旧的承诺交易将被撤销。

    * 参见部分：承诺号，承诺撤销私钥，HTLC，承诺秘密，outpoint
    * 相关：关闭交易，融资交易，罚款交易
    * 请参阅类型：已撤销承诺交易

* *最终节点*：
    * 支付交易数据包的最终收件人，它通过一定数量的跃点从源节点路由付款。在一个交易路径中，它是最终节点。
    * 请参阅类别：节点
    * 参见相关：origin节点，处理节点

* *基础(Funding)交易*：
    * 不可逆转的链上交易，支付给通道的交易双方。它只能在双方同意的情况下才能被花费。
    * 相关：关闭交易，承诺交易，罚款交易

* *跃点(Htop)*：
    * 一个节点(node)。通常，位于起始节点和最终节点之间的中间节点。
    * 请参阅类别：节点

* *HTLC*：哈希时间锁定合约。
    * 两个对等方之间的有条件支付:接收方可以通过签名和前向支付来实施，
     否则支付方可以在指定时间后通过支付取消合同。
     这些是作为承诺交易的输出实现的。
    * 参见容器：承诺交易
    * 参见部分：支付哈希，前向支付

* *发票(Invoice)*：
    * 闪电网络上的资金请求，可能包括付款类型，付款金额，到期日期和其他信息。
     这是在Lightning Network上进行支付的方式，而不是使用比特币地址。

* *合法奇数(It's ok to be odd)*:
    * 适用于某些数字字段的规则，指示对特性的可选或强制支持。偶数表示交易双方必须支持所讨论的特性，而奇数表示该特性可以被另一方忽略。

* *MSAT*：
    * millisatoshi，通常用作字段名称。

* *相互关闭*：
    * 频道的合作关闭，通过向每个对等方(除非一个输出太小，因此不包括在内)广播无条件的资金交易开销来实现。
    * 参见：撤销交易关闭，单边关闭

* *节点*：
    * 作为Lightning网络一部分的计算机或其他设备。
    * 参见：通讯端(peers)
    * 请参阅类型：最终节点，跳，源节点，处理节点，接收节点，发送节点

* *原始节点*：
    * 发起数据包的节点，该数据包将通过一定数量的跳转路由到最终节点。它也是链中的第一个发送端点。
    * 请参阅类别：节点
    * 参见：最终节点，处理节点

* *输出端*：
    * 一个交易哈希和输出索引，用于唯一标识未花费的交易输出。需要撰写新的交易作为输入。
    * 参见：资金交易，承诺交易

* *付款哈希*：
    * HTLC包含支付散列，它是前向支付的散列。
    * 参见：HTLC
    * 参见 originator：payment preimage

* payment preimage：
    * 付款已经收到的证明，由最后的收款人持有，他是唯一知道这个密钥的人。最终收件人释放前向交易以便释放资金。支付前映像被散列为HTLC中的支付散列。
    * 参见：HTLC
    * 参见相关：支付哈希

* *通讯节点(Peers)*：
    * 两个相互通信的节点。
     在建立通道之前，两个端点可能互相发送信号。
     两个端点可以建立一个他们交易的通道。

    * 请参阅相关：节点

* *罚款交易*：
    * 使用承诺撤销私钥，使用已撤销承诺交易的所有输出的交易。如果其他对等方试图通过广播已撤销的承诺交易来“欺骗”，则另外一个端点将执行此方法。
    * 参见：成交，承诺交易，融资交易

* *双方承诺密钥*：
    * 每个承诺交易都从每个承诺的密匙派生出它的密匙，该密匙的生成使得所有以前的承诺的每个承诺密匙系列都可以被紧凑地存储。
    * 参见：承诺交易
    * 参见相关：承诺撤销私钥

* *处理节点*：
    * 正在处理源自源节点并且正向最终节点发送以便路由付款的数据包的节点。它充当接收端以接收消息，然后向对端发送该分组。
    * 请参阅类别：节点
    * 请参阅相关：最终节点，原始节点

* *接收节点*：
    * 正在接收消息的节点。
    * 请参阅类别：节点
    * 参见相关：发送节点

* *接收端*：
    * 正在从直接连接的对端接收消息的节点。
    * 参见：端点
    * 参见相关：发送端

* *撤销承诺交易*：
    * 由于已经协商了新的承诺交易而被撤销的旧承诺交易。
    * 参见：承诺交易

*  *撤销交易关闭*：
    * 通过广播已撤销的承诺交易完成的无效通道关闭。由于另一个对等方知道承诺撤销密钥，因此可以创建一个惩罚交易。
    * 参见：相互关闭，单边关闭

* *路由*：
    * 跨越闪电网络的路径，可实现跨越一个或多个跃点从源节点到最终节点的付款。
    * 参见：通道

* *发送节点*：
    * 正在发送消息的节点。
    * 请参阅：节点
    * 参见相关：接收节点

* *发送同行*：
    * 正在向直接连接的对端发送消息的节点。
    * 参见：端点
    * 参见相关：接收端

* *单方面关闭*：
    * 通过广播承诺交易完成的不合作关闭通道。该交易比结束交易更大（即效率更低），并且其承诺被广播的对等体在某些先前协商的持续时间内不能访问其自己的输出。
    * 参见：相互关闭，撤销交易关闭
